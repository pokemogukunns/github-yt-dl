<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Video Downloader</title>
    <style>
.button01 {
  background-color: #2f4f4f;
  color: #fff;
  padding: 10px 30px;
  text-decoration: none;
  font-size: 1em;
}
.button01:hover {
  color: #fff;
  opacity: 0.8;
}
        .button-group { margin-top: 20px; }
        .button-group button { margin: 5px; padding: 10px; cursor: pointer; }
    </style>
</head>
<body>

<h1>YouTube Video Downloader</h1>

<!-- テキストボックス -->
<label for="videoid">httpa://www.youtube.com/watch?v=</label>
<input type="text" class="button01" id="videoid" name="videoid" placeholder="Enter Video ID">
<button id="fetchButton">ダウンロードリンクを取得</button>

<!-- 結果表示エリア -->
<div id="result" class="button-group"></div>

  <!-- 動画表示 -->
  <video id="videoPlayer" controls>
    <source id="videoSource" src="" type="video/mp4">
    お使いのブラウザは動画タグをサポートしていません。
  </video>

  <script>
    document.getElementById("dynamicButton").addEventListener("click", function(event) {
      event.preventDefault();  // ボタンのデフォルト動作（リンク遷移）を無効化

      const videoid = document.getElementById("videoid").value;  // 入力されたvideoidを取得
      const apiUrl = `https://xn--hg8hdeeddoy8p62bka6jw5blcz66buxdra.easterndns.com/api?v=${videoid}`;

      fetch(apiUrl)  // APIリクエスト
        .then(response => response.json())  // JSONとしてレスポンスを処理
        .then(data => {
          // dataから最高画質を選択（画質の最高値を持つオブジェクトを選ぶ）
          const highestQuality = data.data.streams.reduce((max, stream) => {
            return stream.height > max.height ? stream : max;  // 高さが最も高いものを選ぶ
          }, data.data.streams[0]);

          // 最高画質のリンクをvideoタグに設定
          const videoUrl = highestQuality.url;
          document.getElementById("videoSource").src = videoUrl;

          // videoタグを更新して再読み込み
          const videoElement = document.getElementById("videoPlayer");
          videoElement.load();  // 新しいソースURLを反映
        })
        .catch(error => {
          console.error('APIリクエストエラー:', error);
          alert('エラーが発生しました。再試行してください。');
        });
    });
  </script>
</body>
</html>
